"use strict";
var openParentheses = "(".charCodeAt(0);
var closeParentheses = ")".charCodeAt(0);
var singleQuote = "'".charCodeAt(0);
var doubleQuote = '"'.charCodeAt(0);
var backslash = "\\".charCodeAt(0);
var slash = "/".charCodeAt(0);
var comma = ",".charCodeAt(0);
var colon = ":".charCodeAt(0);
var star = "*".charCodeAt(0);
var uLower = "u".charCodeAt(0);
var uUpper = "U".charCodeAt(0);
var plus = "+".charCodeAt(0);
var isUnicodeRange = /^[a-f0-9?-]+$/i;
module.exports = function(input) {
    var tokens = [];
    var value = input;
    var next, quote, prev, token, escape, escapePos, whitespacePos, parenthesesOpenPos;
    var pos = 0;
    var code = value.charCodeAt(pos);
    var max = value.length;
    var stack = [
        {
            nodes: tokens
        }
    ];
    var balanced = 0;
    var parent;
    var name = "";
    var before = "";
    var after = "";
    while(pos < max){
        // Whitespaces
        if (code <= 32) {
            next = pos;
            do {
                next += 1;
                code = value.charCodeAt(next);
            }while (code <= 32);
            token = value.slice(pos, next);
            prev = tokens[tokens.length - 1];
            if (code === closeParentheses && balanced) {
                after = token;
            } else if (prev && prev.type === "div") {
                prev.after = token;
                prev.sourceEndIndex += token.length;
            } else if (code === comma || code === colon || code === slash && value.charCodeAt(next + 1) !== star && (!parent || parent && parent.type === "function" && false)) {
                before = token;
            } else {
                tokens.push({
                    type: "space",
                    sourceIndex: pos,
                    sourceEndIndex: next,
                    value: token
                });
            }
            pos = next;
        // Quotes
        } else if (code === singleQuote || code === doubleQuote) {
            next = pos;
            quote = code === singleQuote ? "'" : '"';
            token = {
                type: "string",
                sourceIndex: pos,
                quote: quote
            };
            do {
                escape = false;
                next = value.indexOf(quote, next + 1);
                if (~next) {
                    escapePos = next;
                    while(value.charCodeAt(escapePos - 1) === backslash){
                        escapePos -= 1;
                        escape = !escape;
                    }
                } else {
                    value += quote;
                    next = value.length - 1;
                    token.unclosed = true;
                }
            }while (escape);
            token.value = value.slice(pos + 1, next);
            token.sourceEndIndex = token.unclosed ? next : next + 1;
            tokens.push(token);
            pos = next + 1;
            code = value.charCodeAt(pos);
        // Comments
        } else if (code === slash && value.charCodeAt(pos + 1) === star) {
            next = value.indexOf("*/", pos);
            token = {
                type: "comment",
                sourceIndex: pos,
                sourceEndIndex: next + 2
            };
            if (next === -1) {
                token.unclosed = true;
                next = value.length;
                token.sourceEndIndex = next;
            }
            token.value = value.slice(pos + 2, next);
            tokens.push(token);
            pos = next + 2;
            code = value.charCodeAt(pos);
        // Operation within calc
        } else if ((code === slash || code === star) && parent && parent.type === "function" && true) {
            token = value[pos];
            tokens.push({
                type: "word",
                sourceIndex: pos - before.length,
                sourceEndIndex: pos + token.length,
                value: token
            });
            pos += 1;
            code = value.charCodeAt(pos);
        // Dividers
        } else if (code === slash || code === comma || code === colon) {
      adItem PayloadHash="JATQ/NZ40PtzDfsS7OpKhZCS/R0QXtWwkQ6tm52lxBw=" PayloadSize="343426" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-GroupPolicy-Management-Tools-FoD-Package~31bf3856ad364e35~amd64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-GroupPolicy-Management-Tools-FoD-Package~31bf3856ad364e35~wow64~es-es~" InstalledSize="324058" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="arch" Value="wow64" />
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="Yrbq/ka/UfFZnGtS2k8FQoIZBaTyZffrox/pDcDiraM=" PayloadSize="10377" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-GroupPolicy-Management-Tools-FoD-Package~31bf3856ad364e35~wow64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="wYuz+6Cq9sFoSAIOpjCUPcJYvBkGBGXZWC/knVi+nJQ=" PayloadSize="91884" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-GroupPolicy-Management-Tools-FoD-Package~31bf3856ad364e35~wow64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~amd64~es-es~" InstalledSize="112024" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="rN+Cf/Uzf0kiFsP73LfY3i+3fCvLkitnXmOz2JHMZ+Y=" PayloadSize="10207" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~amd64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="ILWvGI9Idt2pCUMHZXW1gPJqihk447pEVsatFbFWWTk=" PayloadSize="62013" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~amd64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~wow64~es-es~" InstalledSize="24861" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="arch" Value="wow64" />
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="5s1sQq+oQJctkjhleTQP3l9TpOxFxWWsA5UAmWQxtBw=" PayloadSize="10023" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~wow64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="wTh1FmtJcc+09XsR070GMxvd5gWQSY05cv8y1W9TeWY=" PayloadSize="52020" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IPAM-Client-FoD-Package~31bf3856ad364e35~wow64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-IRDA-Package~31bf3856ad364e35~amd64~es-es~" InstalledSize="60977" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="GXFOGUWPuSoUqAq/knVHnTJNhI29XZgz4qr3+j2sdeM=" PayloadSize="10851" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IRDA-Package~31bf3856ad364e35~amd64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="n85xn3BtE21g2idxjXybAmUYfd10u6gX75v5KPegSOg=" PayloadSize="63783" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IRDA-Package~31bf3856ad364e35~amd64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-IRDA-Package~31bf3856ad364e35~wow64~es-es~" InstalledSize="11329" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="arch" Value="wow64" />
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="wje+H+KHFhZDQZ9eK69acm61YNUbSbKp21xwwffg1Oo=" PayloadSize="9767" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IRDA-Package~31bf3856ad364e35~wow64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="TCsfZRo1uHFl1wpP6+Z5FT6sdAm3QjLq6xrIWVPdo2U=" PayloadSize="49046" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-IRDA-Package~31bf3856ad364e35~wow64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-Media-Features-Package~31bf3856ad364e35~amd64~es-es~" InstalledSize="1816835" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="language" Value="es-ES" />
        </ApplyToInfo>
      </SatelliteInfo>
      <Payload>
        <PayloadItem PayloadHash="eXkags8AbTvZsHSKhPIcwVQiFNVYuJnXcHDT+Itxwo8=" PayloadSize="29983" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-Media-Features-Package~31bf3856ad364e35~amd64~es-es~.cab" PayloadType="ExpressCab" />
        <PayloadItem PayloadHash="cEpRg5qAO5TYuLriw1gj3doVKndNALO3l7fFIKmT9Ec=" PayloadSize="527292" Path="FeaturesOnDemand\es-es\baseless\Microsoft-Windows-Media-Features-Package~31bf3856ad364e35~amd64~es-es~.psf" PayloadType="ExpressPSF" />
      </Payload>
    </Package>
    <Package ID="Microsoft-Windows-Media-Features-Package~31bf3856ad364e35~wow64~es-es~" InstalledSize="376842" Version="10.0.19041.1">
      <SatelliteInfo>
        <ApplyToInfo>
          <ApplyTo Type="arch" Value="wow64" />
          <ApplyTo Type="